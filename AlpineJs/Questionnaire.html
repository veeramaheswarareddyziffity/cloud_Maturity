<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Questionnaire</title>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js"
    ></script>
    <script src="Questionnaire.js"></script>
    <style>
      [x-cloak] {
        display: none;
      }
    </style>
  </head>
  <body>
    <div
      x-data="quizData"
      x-init="
      fetch('http://localhost:7000/api/questionnaire')
        .then(response => response.json())
        .then(data => {
          questions = data;
          page = data.page_no;
        })
        .catch(error => console.error('Error fetching questionnaire:', error));
    "
    >
      <template x-if="!questions">
        <div>Loading...</div>
      </template>

      <template x-if="showScore">
        <div id="scoreDetails">
          <h2>Quiz is Completed!</h2>
          <h3>Your Score: <span x-text="score"></span></h3>
        </div>
      </template>

      <template x-if="questions && !showScore">
        <div class="container">
          <h1>Cloud Maturity Questionnaire</h1>
          <h2 x-text="questions.page_name"></h2>

          <template x-for="question in questions.questions" :key="question.id">
            <div>
              <h3 x-text="question.question_text"></h3>
              <form>
                <template
                  x-for="option in questions.options.filter(opt => opt.question_id === question.id)"
                  :key="option.option_id"
                >
                  <div id="options">
                    <input
                      type="radio"
                      :id="option.option_id"
                      :name="'question_' + question.id + '_options'"
                      :value="option.option_id"
                      @click="responses[question.id] = option.option_text"
                    />
                    <label
                      :for="option.option_id"
                      x-text="option.option_text"
                    ></label>
                  </div>
                </template>
              </form>
            </div>
          </template>

          <template x-if="errorMessage" class="error-message">
            <p style="color: red" x-text="errorMessage"></p>
          </template>

          <button @click="handleSubmit()">Submit</button>
        </div>
      </template>
    </div>

  </body>
</html>
